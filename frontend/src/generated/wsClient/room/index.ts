// Code generated by protoc-gen-ts. DO NOT EDIT.
import type * as RoomSchema from './schema';
import ReconnectingWebSocket from "reconnecting-websocket";
import { useEffect, useRef } from "react";
type Props = {
	baseUrl: string;
	ChangeUserPosition: (payload:RoomSchema.ChangeUserPosition["payload"])=>void;
	JoinRoom: (payload:RoomSchema.JoinRoom["payload"])=>void;
	ChangeScreenSizeToUser: (payload:RoomSchema.ChangeScreenSizeToUser["payload"])=>void;
	LeaveRoom: (payload:RoomSchema.LeaveRoom["payload"])=>void;
}
export const useRoomWSClient = (props:Props) => {
	const connectionRef = useRef<ReconnectingWebSocket | null>(
		null,
	);
	const handleEvents = (e:MessageEvent) =>{
		const data = JSON.parse(e.data);
		switch (data.type) {
				case 'ChangeUserPosition':
					props.ChangeUserPosition(data.payload as RoomSchema.ChangeUserPosition["payload"])
					break;
				case 'JoinRoom':
					props.JoinRoom(data.payload as RoomSchema.JoinRoom["payload"])
					break;
				case 'ChangeScreenSizeToUser':
					props.ChangeScreenSizeToUser(data.payload as RoomSchema.ChangeScreenSizeToUser["payload"])
					break;
				case 'LeaveRoom':
					props.LeaveRoom(data.payload as RoomSchema.LeaveRoom["payload"])
					break;
			}
	}
	const handleChangeCurrentPosition = (payload:RoomSchema.ChangeCurrentPosition["payload"]) => {
		connectionRef.current?.send(JSON.stringify({type:'ChangeCurrentPosition', payload:payload}))
	}
	const handleChangeCurrentScreen = (payload:RoomSchema.ChangeCurrentScreen["payload"]) => {
		connectionRef.current?.send(JSON.stringify({type:'ChangeCurrentScreen', payload:payload}))
	}
	useEffect(() => {
			const ws = new ReconnectingWebSocket(props.baseUrl);
			connectionRef.current = ws;
			ws.onmessage = handleEvents;
			return () => {
				ws.close();
			}
	},[])
	return {
		handleChangeCurrentPosition,
		handleChangeCurrentScreen,
		connection: connectionRef.current
	}
}
