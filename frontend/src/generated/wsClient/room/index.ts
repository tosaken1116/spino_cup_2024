// Code generated by protoc-gen-ts. DO NOT EDIT.
import type * as RoomSchema from './schema';
import ReconnectingWebSocket from "reconnecting-websocket";
import { useEffect, useRef } from "react";
type Props = {
	baseUrl: string;
	ChangeUserPosition: (payload:RoomSchema.ChangeUserPosition)=>void;
	ChangeCurrentPosition: (payload:RoomSchema.ChangeCurrentPosition)=>void;
	ChangeCurrentScreen: (payload:RoomSchema.ChangeCurrentScreen)=>void;
}
export const useRoomWSClient = (props:Props) => {
	const connectionRef = useRef<ReconnectingWebSocket | null>(
		null,
	);
	const handleEvents = (e:MessageEvent) =>{
		const data = JSON.parse(e.data);
		switch (data.type) {
				case 'ChangeUserPosition':
					props.ChangeUserPosition(data.payload as RoomSchema.ChangeUserPosition)
					break;
				case 'ChangeCurrentPosition':
					props.ChangeCurrentPosition(data.payload as RoomSchema.ChangeCurrentPosition)
					break;
				case 'ChangeCurrentScreen':
					props.ChangeCurrentScreen(data.payload as RoomSchema.ChangeCurrentScreen)
					break;
			}
	}
	useEffect(() => {
			const ws = new ReconnectingWebSocket(props.baseUrl);
			connectionRef.current = ws;
			ws.onmessage = handleEvents;
			return () => {
				ws.close();
			}
	})
	return {
		connection: connectionRef.current
	}
}
